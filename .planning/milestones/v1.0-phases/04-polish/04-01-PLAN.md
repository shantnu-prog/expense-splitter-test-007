---
phase: 04-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/TabBar.tsx
  - src/components/layout/AppShell.tsx
  - src/components/layout/OnboardingScreen.tsx
  - src/components/people/PeoplePanel.tsx
  - src/components/items/ItemsPanel.tsx
  - src/components/items/ItemRow.tsx
  - src/components/assignments/AssignmentPanel.tsx
  - src/components/summary/SummaryPanel.tsx
  - src/components/tip-tax/TipSegmentedControl.tsx
  - src/components/tip-tax/TaxInput.tsx
  - src/hooks/useOnboarding.ts
  - src/index.css
autonomous: true
requirements: []

must_haves:
  truths:
    - "User can navigate all four tabs using only Left/Right arrow keys, Home, and End — no mouse required"
    - "Tab key moves focus into the tab bar as a single stop; arrow keys move between tabs"
    - "Enter key in the People name input does NOT submit the form — user must Tab to Add button"
    - "Empty People/Items/Assign panels show centered guidance text and an action button that focuses the add input or switches tabs"
    - "Fresh first-time load shows a minimal onboarding splash with app name, tagline, and Start button"
    - "All input elements have font-size >= 16px (text-base) preventing iOS Safari auto-zoom"
    - "Body and html have overscroll-none preventing rubber-band bounce on iOS"
  artifacts:
    - path: "src/components/layout/TabBar.tsx"
      provides: "Roving tabindex with arrow key navigation"
      contains: "tabIndex={isActive ? 0 : -1}"
    - path: "src/components/layout/OnboardingScreen.tsx"
      provides: "Minimal splash screen"
      contains: "Split bills fairly"
    - path: "src/hooks/useOnboarding.ts"
      provides: "localStorage-backed onboarding state hook"
      contains: "localStorage"
    - path: "src/index.css"
      provides: "Global overscroll-none on html/body"
      contains: "overscroll-none"
  key_links:
    - from: "src/components/layout/AppShell.tsx"
      to: "src/components/layout/OnboardingScreen.tsx"
      via: "useOnboarding hook gates app render"
      pattern: "showOnboarding"
    - from: "src/components/layout/TabBar.tsx"
      to: "src/components/layout/AppShell.tsx"
      via: "onTabChange callback"
      pattern: "onTabChange"
    - from: "src/components/assignments/AssignmentPanel.tsx"
      to: "src/components/layout/AppShell.tsx"
      via: "onTabChange prop for cross-tab navigation"
      pattern: "onTabChange"
---

<objective>
Add keyboard navigation (ARIA tabs pattern with roving tabindex), empty state guidance for all panels, a minimal first-time onboarding splash, and mobile QA polish (iOS font-size fix, touch targets, overscroll behavior, subtle transitions).

Purpose: Make the app feel complete and professional — keyboard-friendly, self-guiding for new users, and polished on mobile.
Output: Updated TabBar with arrow key navigation, new OnboardingScreen component, empty states in all panels, iOS input zoom fix across all inputs, global overscroll fix in index.css.
</objective>

<execution_context>
@/Users/shantnupatil/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shantnupatil/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-polish/04-CONTEXT.md
@.planning/phases/04-polish/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Keyboard navigation (roving tabindex TabBar) + remove Enter-submit + onboarding screen</name>
  <files>
    src/components/layout/TabBar.tsx
    src/components/layout/AppShell.tsx
    src/components/layout/OnboardingScreen.tsx
    src/components/people/PeoplePanel.tsx
    src/hooks/useOnboarding.ts
  </files>
  <action>
**TabBar.tsx — Add roving tabindex and keyboard navigation (WAI-ARIA tabs pattern):**
1. Import `useRef` from React.
2. Add `const tabRefs = useRef<Record<number, HTMLButtonElement | null>>({})` for tab button refs.
3. Add `const activeIndex = TABS.findIndex((t) => t.id === activeTab)` to track current index.
4. Add `focusTab(index: number)` function that calls `tabRefs.current[index]?.focus()`.
5. Add `handleKeyDown(e: React.KeyboardEvent, currentIndex: number)` implementing:
   - `ArrowRight` → focus next tab (wraps: `(currentIndex + 1) % count`)
   - `ArrowLeft` → focus previous tab (wraps: `(currentIndex - 1 + count) % count`)
   - `Home` → focus first tab (index 0)
   - `End` → focus last tab (index `count - 1`)
   - Call `e.preventDefault()` for all handled keys.
6. On each `<button>`:
   - Add `ref={(el) => { tabRefs.current[index] = el; }}` (use the `index` from TABS.map callback)
   - Add `tabIndex={isActive ? 0 : -1}` — active tab has tabIndex 0, all others -1
   - Add `onFocus={() => onTabChange(tab.id)}` — selection follows focus per WAI-ARIA APG
   - Add `onKeyDown={(e) => handleKeyDown(e, index)}`
7. Add `aria-orientation="horizontal"` to the `<nav role="tablist">` element.
8. Keep the existing `onClick` handler unchanged.

**PeoplePanel.tsx — Remove Enter-to-submit:**
- Remove the `onKeyDown={(e) => e.key === 'Enter' && handleAdd()}` handler from the name input. Per CONTEXT.md locked decision: Enter in text inputs does NOT submit. User must Tab to the Add button and press Enter/Space.

**OnboardingScreen.tsx — New file:**
Create a minimal splash screen component:
```tsx
interface OnboardingScreenProps {
  onDismiss: () => void;
}

export function OnboardingScreen({ onDismiss }: OnboardingScreenProps) {
  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-gray-950 px-6 text-center">
      <h1 className="text-3xl font-bold text-white mb-2">SplitCheck</h1>
      <p className="text-gray-400 text-base mb-8">Split bills fairly</p>
      <button
        onClick={onDismiss}
        className="px-8 py-3 bg-blue-600 text-white font-semibold rounded-xl min-h-12 text-base active:bg-blue-700"
      >
        Start
      </button>
    </div>
  );
}
```

**useOnboarding.ts — New hook:**
Create a localStorage-backed hook:
```tsx
import { useState } from 'react';
const ONBOARDING_KEY = 'bill-splitter-onboarding-complete';
export function useOnboarding() {
  const [showOnboarding, setShowOnboarding] = useState<boolean>(
    () => localStorage.getItem(ONBOARDING_KEY) === null
  );
  function dismissOnboarding() {
    localStorage.setItem(ONBOARDING_KEY, 'true');
    setShowOnboarding(false);
  }
  return { showOnboarding, dismissOnboarding };
}
```
Use localStorage first-time-only (Claude's discretion per CONTEXT.md). Returning users skip the splash.

**AppShell.tsx — Wire onboarding gate:**
1. Import `useOnboarding` and `OnboardingScreen`.
2. At the top of `AppShell`, call `const { showOnboarding, dismissOnboarding } = useOnboarding()`.
3. Before the main layout return, add: `if (showOnboarding) return <OnboardingScreen onDismiss={dismissOnboarding} />;`
4. Pass `setActiveTab` (the `onTabChange` callback) as a prop to `AssignmentPanel` so it can navigate to other tabs from its empty state. Update the `AssignmentPanel` div to: `<AssignmentPanel onTabChange={setActiveTab} />`.
  </action>
  <verify>
1. `npx vitest run` — all existing tests pass (no regressions from removing Enter handler or adding new components).
2. Manual: Open app in browser, Tab into tab bar, press ArrowRight/ArrowLeft to move between tabs, verify Home/End jump to first/last tab.
3. Manual: In People tab, type a name and press Enter — verify nothing happens (no form submission).
4. Manual: Clear localStorage and refresh — verify onboarding splash appears. Click Start — verify app loads. Refresh again — verify onboarding does NOT appear.
  </verify>
  <done>
- TabBar supports full keyboard navigation: ArrowLeft, ArrowRight, Home, End with wrapping
- Only the active tab has tabIndex=0; inactive tabs have tabIndex=-1
- Enter key in People name input no longer submits
- Onboarding splash appears on first visit, stores dismissal in localStorage, skips on return visits
- AppShell passes onTabChange to AssignmentPanel for cross-tab navigation
  </done>
</task>

<task type="auto">
  <name>Task 2: Empty state guidance for all panels + mobile QA polish (iOS font-size, overscroll, transitions)</name>
  <files>
    src/components/people/PeoplePanel.tsx
    src/components/items/ItemsPanel.tsx
    src/components/assignments/AssignmentPanel.tsx
    src/components/summary/SummaryPanel.tsx
    src/components/items/ItemRow.tsx
    src/components/tip-tax/TipSegmentedControl.tsx
    src/components/tip-tax/TaxInput.tsx
    src/index.css
  </files>
  <action>
**PeoplePanel.tsx — Empty state:**
1. Add `useRef<HTMLInputElement>(null)` for the add input. Attach `ref={addInputRef}` to the name `<input>`.
2. When `people.length === 0`, render below the add form (inside the list area):
```tsx
<div className="flex flex-col items-center justify-center py-16 px-6 text-center gap-4">
  <p className="text-gray-400 text-base">No people added yet</p>
  <p className="text-gray-500 text-sm">Add everyone splitting this bill</p>
  <button
    onClick={() => addInputRef.current?.focus()}
    className="px-5 py-2 bg-blue-600 text-white rounded-lg min-h-11 text-sm font-medium active:bg-blue-700"
  >
    Add your first person
  </button>
</div>
```
3. Add `text-base` to the name `<input>` className (iOS font-size fix: ensures >= 16px to prevent auto-zoom on focus).

**ItemsPanel.tsx — Empty state:**
1. Add `useRef<HTMLDivElement>(null)` for the list container. Attach `ref={listRef}` to the items list div.
2. When `items.length === 0`, render below the + button:
```tsx
<div className="flex flex-col items-center justify-center py-16 px-6 text-center gap-4">
  <p className="text-gray-400 text-base">No items on the bill</p>
  <p className="text-gray-500 text-sm">Tap + above to add your first item</p>
</div>
```
(No focus-forwarding button here since the + button is always visible at the top.)

**ItemRow.tsx — iOS font-size fix:**
- Add `text-base` to both the name input (`flex-1 bg-transparent...`) and the price input (`w-24 min-h-10...`) className strings.

**TipSegmentedControl.tsx — iOS font-size fix:**
- Add `text-base` to the custom tip percentage input className (currently `text-sm` — replace with `text-base`).

**TaxInput.tsx — iOS font-size fix:**
- Add `text-base` to the tax amount input className (currently `text-sm` — replace with `text-base`).

**AssignmentPanel.tsx — Enhanced empty states with cross-tab navigation:**
1. Accept `onTabChange` prop: `interface AssignmentPanelProps { onTabChange: (tab: 'people' | 'items' | 'assignments' | 'split') => void; }`
2. Update `items.length === 0` empty state:
```tsx
<div className="flex flex-col items-center justify-center py-16 px-6 text-center gap-4">
  <p className="text-gray-400 text-base">No items to assign</p>
  <p className="text-gray-500 text-sm">Add items first to start assigning</p>
  <button
    onClick={() => onTabChange('items')}
    className="px-5 py-2 bg-blue-600 text-white rounded-lg min-h-11 text-sm font-medium active:bg-blue-700"
  >
    Go to Items
  </button>
</div>
```
3. Update `people.length === 0` empty state:
```tsx
<div className="flex flex-col items-center justify-center py-16 px-6 text-center gap-4">
  <p className="text-gray-400 text-base">No people added</p>
  <p className="text-gray-500 text-sm">Add people first to start assigning</p>
  <button
    onClick={() => onTabChange('people')}
    className="px-5 py-2 bg-blue-600 text-white rounded-lg min-h-11 text-sm font-medium active:bg-blue-700"
  >
    Go to People
  </button>
</div>
```

**SummaryPanel.tsx — Split tab empty state:**
After the `if (!result.ok)` error branch (which handles unassigned items), add a check for "no tip and no tax configured yet" when the result IS ok but the user hasn't configured anything:
```tsx
// Show guidance when tip AND tax are both zero (unconfigured)
const tipCents = useBillStore((s) => s.config.tip.amountCents);
const taxCents = useBillStore((s) => s.config.tax.amountCents);
```
Add these selectors (can be added to the existing useShallow call). Then after the `!result.ok` branch:
```tsx
if (result.ok && tipCents === 0 && taxCents === 0 && people.length > 0) {
  // Still show the summary but add a guidance prompt at the top
  // (Don't block rendering — just add a helpful note)
}
```
Actually, per CONTEXT.md: "Configure tip and tax above to see the split" — this implies blocking the summary until configured. But since the TipTaxPanel is always above the SummaryPanel in the Split tab, and the summary already works without tip/tax (just shows food totals), the best UX is to show a hint banner at the top of the summary panel, NOT block it:
```tsx
{result.ok && tipCents === 0 && taxCents === 0 && (
  <div className="mx-4 mt-4 px-4 py-3 bg-gray-800/50 rounded-lg text-center">
    <p className="text-gray-400 text-sm">Configure tip and tax above to see the full split</p>
  </div>
)}
```
Render this just before the bill total header, inside the outer `<div className="flex flex-col">`.

**index.css — Global overscroll fix + scroll-smooth:**
Update the existing `html, body, #root` rule:
```css
html, body, #root {
  @apply min-h-screen bg-gray-950 text-gray-100 overscroll-none;
}
```

**AppShell.tsx — Overscroll on main + subtle transitions:**
- Add `overscroll-contain` to `<main>` className: `"flex-1 overflow-y-auto pb-16 overscroll-contain"`.
- Add `motion-reduce:transition-none` as a safety for reduced-motion users to any transition-bearing elements.

**Touch target audit (verify existing elements):**
The research audit shows existing buttons already use `min-h-10`/`min-h-12`/`min-w-10` which are >= 40px. Tailwind `min-h-11` = 44px = Apple HIG minimum. Where any interactive element is smaller than 44px, bump to `min-h-11 min-w-11`. Check:
- PersonRow remove button: currently `min-h-10 min-w-10` (40px) — bump to `min-h-11 min-w-11` (44px)
- ItemRow remove button: currently `min-h-10 min-w-10` — bump to `min-h-11 min-w-11`
- ItemRow quantity buttons: currently `min-w-10 min-h-10` — bump to `min-w-11 min-h-11`
- TaxInput mode toggle buttons: currently no min-h — add `min-h-11`
  </action>
  <verify>
1. `npx vitest run` — all tests pass.
2. Manual: Open People tab with no people — verify centered empty state with "Add your first person" button. Click button — verify focus moves to name input.
3. Manual: Open Items tab with no items — verify empty state message. Open Assign tab with no items — verify "Go to Items" button switches to Items tab.
4. Manual: Inspect all `<input>` elements and verify font-size is 16px (text-base) via browser dev tools — no iOS zoom on focus.
5. Manual: Verify `overscroll-behavior: none` on html/body via browser dev tools.
6. Manual: Verify all remove buttons and quantity buttons are at least 44x44px.
  </verify>
  <done>
- PeoplePanel shows empty state with focus-forwarding action button when no people exist
- ItemsPanel shows empty state guidance when no items exist
- AssignmentPanel shows cross-tab navigation buttons to People or Items tabs when prerequisites are missing
- SummaryPanel shows hint banner when tip and tax are both unconfigured
- All text inputs have text-base (16px) preventing iOS Safari auto-zoom
- html/body have overscroll-none; main has overscroll-contain
- All interactive elements meet 44x44px minimum touch target
  </done>
</task>

</tasks>

<verification>
1. `npx vitest run` — full test suite passes with zero failures
2. Keyboard flow: Tab into tab bar → ArrowRight cycles through all 4 tabs → Home/End jump to first/last → Tab out of tab bar works (no focus trap)
3. Enter key does NOT submit in People name input
4. Empty states visible on fresh app (no people, no items, no assignments)
5. First-time onboarding splash appears; subsequent loads skip it
6. All inputs have font-size >= 16px (no iOS zoom)
7. Touch targets are all >= 44x44px
8. No overscroll bounce on body
</verification>

<success_criteria>
- Full keyboard navigation works for the tab bar (arrow keys, Home, End, wrapping)
- Empty states provide clear guidance and action buttons in all four panel contexts
- Onboarding splash shows on first visit only (localStorage gated)
- iOS font-size zoom prevention on all inputs
- Touch targets meet 44px minimum
- Overscroll bounce eliminated
- All existing tests pass (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/04-polish/04-01-SUMMARY.md`
</output>
