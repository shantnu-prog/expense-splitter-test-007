---
phase: 02-data-entry
plan: 03
type: execute
wave: 3
depends_on:
  - 02-02
files_modified:
  - src/components/assignments/AssignmentPanel.tsx
  - src/components/assignments/AssignmentRow.tsx
  - src/components/assignments/AssignmentPanel.test.tsx
  - src/components/layout/AppShell.tsx
autonomous: false
requirements:
  - ASGN-01
  - UX-01

must_haves:
  truths:
    - "Each item in the Assignment tab shows a list of people with checkboxes"
    - "Checking a person's checkbox assigns them to the item in the store"
    - "Unchecking a person's checkbox removes their assignment"
    - "Tapping 'Everyone' button selects all people for that item"
    - "Tapping 'Everyone' again (when all selected) deselects all people"
    - "Unassigned items show a subtle amber warning badge (not red)"
    - "Assignment tab badge on TabBar shows count of unassigned items"
    - "The full data entry flow works on a phone-sized viewport with dark theme"
  artifacts:
    - path: "src/components/assignments/AssignmentPanel.tsx"
      provides: "Item-centric assignment list with expandable checklists"
      min_lines: 30
    - path: "src/components/assignments/AssignmentRow.tsx"
      provides: "Single item row that expands to show person checkboxes and Everyone button"
      min_lines: 50
    - path: "src/components/assignments/AssignmentPanel.test.tsx"
      provides: "Component tests for assign/unassign/everyone/warning"
      min_lines: 40
  key_links:
    - from: "src/components/assignments/AssignmentRow.tsx"
      to: "src/store/billStore.ts"
      via: "calls assignItem(itemId, personIds[]) to update assignments"
      pattern: "assignItem"
    - from: "src/components/assignments/AssignmentPanel.tsx"
      to: "src/store/billStore.ts"
      via: "useBillStore with useShallow for items, people, assignments, assignItem"
      pattern: "useBillStore.*useShallow"
    - from: "src/components/layout/AppShell.tsx"
      to: "src/components/assignments/AssignmentPanel.tsx"
      via: "renders AssignmentPanel in assignments tab slot"
      pattern: "AssignmentPanel"
---

<objective>
Build the Assignment panel with item-centric checkbox lists, "Everyone" button, and unassigned-item warnings, completing the full data entry flow. Includes a visual checkpoint for the user to verify the entire flow on a phone-sized viewport.

Purpose: This is the final panel that connects items to people — the core mechanism of bill splitting. Without assignments, the engine cannot compute per-person totals. The visual checkpoint ensures the dark theme, touch targets, and tab flow feel right on mobile before moving to Phase 3 output.

Output: Complete data entry UI with all three panels functional, verified by component tests and human visual inspection.
</objective>

<execution_context>
@/Users/shantnupatil/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shantnupatil/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-data-entry/02-CONTEXT.md
@.planning/phases/02-data-entry/02-RESEARCH.md
@.planning/phases/02-data-entry/02-02-SUMMARY.md
@src/engine/types.ts
@src/store/billStore.ts
@src/components/layout/AppShell.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build Assignment panel with item-centric checklists, Everyone button, and unassigned warnings</name>
  <files>
    src/components/assignments/AssignmentRow.tsx
    src/components/assignments/AssignmentPanel.tsx
    src/components/assignments/AssignmentPanel.test.tsx
    src/components/layout/AppShell.tsx
  </files>
  <action>
1. Create `src/components/assignments/AssignmentRow.tsx`:
   - Props: `item: Item`, `people: Person[]`, `assignedIds: PersonId[]`, `onAssign: (itemId: ItemId, personIds: PersonId[]) => void`.
   - Local state: `expanded: boolean` (useState, default false).
   - Compute: `allAssigned = assignedIds.length === people.length && people.length > 0`, `noneAssigned = assignedIds.length === 0`.
   - Item header row (clickable to expand/collapse): display item label on left, assignment count on right (e.g., "2/4" in `text-gray-400 text-sm`). If `noneAssigned`, show amber warning indicator: `<span className="text-amber-400 text-xs font-bold" aria-label="Unassigned">!</span>` — subtle per locked decision (not alarming red). Chevron or expand indicator. Entire row: `min-h-12 w-full flex items-center justify-between py-3 px-4`.
   - Expanded content (when `expanded === true`):
     a. "Everyone" button at the top of the checklist — prominent per locked decision. Style: `w-full min-h-10 rounded-lg text-sm font-medium bg-blue-600/20 text-blue-400 active:bg-blue-600/30`. Text: "Everyone" when not all assigned, "Deselect All" when all assigned. onClick: if `allAssigned`, call `onAssign(item.id, [])`, else call `onAssign(item.id, people.map(p => p.id))`.
     b. Person checklist: map `people` to rows, each with a checkbox and person name. Checkbox: `<input type="checkbox" checked={assignedIds.includes(person.id)} onChange={() => togglePerson(person.id)} className="w-5 h-5 rounded accent-blue-500" />`. Label wrapping: `<label className="flex items-center gap-3 min-h-10 px-2 rounded-lg active:bg-gray-800 cursor-pointer">`.
   - `togglePerson(personId)`: if already assigned, filter out; else append. Call `onAssign(item.id, newIds)`.
   - Row container: `border-b border-gray-800`.

2. Create `src/components/assignments/AssignmentPanel.tsx`:
   - Store connection: use `useShallow` to select `config.items`, `config.people`, `config.assignments`, `assignItem` from `useBillStore`.
   - If no items exist, show empty state message: "Add items first" in `text-gray-400 text-center py-8`.
   - If no people exist, show: "Add people first" in same style.
   - Otherwise, map items to `<AssignmentRow>` components, passing `item`, `people`, `assignedIds={assignments[item.id] || []}`, `onAssign={assignItem}`.
   - Wrap in `flex flex-col h-full` with `flex-1 overflow-y-auto` for the list.

3. Create `src/components/assignments/AssignmentPanel.test.tsx`:
   - Add `// @vitest-environment jsdom` at the top.
   - `beforeEach`: reset store, then seed with 2 people ("Alice", "Bob") and 2 items ("Pizza" at 1200 cents, "Salad" at 800 cents) via store actions.
   - Tests:
     a. "shows items with assignment counts" — render, expect "Pizza" and "Salad" visible, expect "0/2" displayed for each (no assignments yet).
     b. "shows empty state when no items" — reset store, add 2 people but no items, render, expect "Add items first".
     c. "shows empty state when no people" — reset store, add 2 items but no people, render, expect "Add people first".
     d. "expands item to show person checkboxes" — click on "Pizza" row, expect "Alice" and "Bob" checkboxes visible, expect "Everyone" button visible.
     e. "assigns person when checkbox is checked" — expand "Pizza", click "Alice" checkbox, verify `useBillStore.getState().config.assignments` has Alice assigned to Pizza's item ID.
     f. "unassigns person when checkbox is unchecked" — assign Alice to Pizza via store, expand Pizza, click Alice checkbox (uncheck), verify Alice removed from Pizza's assignments.
     g. "Everyone button assigns all people" — expand "Pizza", click "Everyone" button, verify both Alice and Bob assigned in store.
     h. "Everyone button deselects all when all assigned" — assign both people to Pizza via store, expand Pizza, expect button text "Deselect All", click it, verify empty assignments for Pizza.
     i. "shows amber warning for unassigned items" — render with no assignments, expect amber "!" indicators visible (aria-label "Unassigned").
     j. "assignment count updates after assigning" — expand Pizza, click "Everyone", verify count shows "2/2".

4. Update `src/components/layout/AppShell.tsx`:
   - Import `AssignmentPanel` from `../assignments/AssignmentPanel`.
   - Replace the assignments tab placeholder div content with `<AssignmentPanel />`.
   - Now all three tab placeholders are replaced with real components.

5. Run `npx vitest run` — all tests must pass.
  </action>
  <verify>
    `npx vitest run` passes with 0 failures. AssignmentPanel test file shows all 10 test cases passing. Dev server shows functional Assign tab with expandable checklists.
  </verify>
  <done>
    Assignment panel renders in the Assign tab with item-centric layout. Each item expands to show a checklist of people with checkboxes. "Everyone" button toggles select/deselect all. Unassigned items show amber "!" badge. Assignment changes are persisted to the Zustand store via assignItem action. TabBar badge shows unassigned count. All interactions verified by 10 component tests.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of complete data entry flow on mobile viewport</name>
  <files>no files modified — visual verification only</files>
  <action>
Human visually verifies the complete data entry flow built across Plans 01-03. Start the dev server and test on a mobile viewport.

**What was built:** Complete data entry UI with three tabbed panels (People, Items, Assignments), dark theme, running subtotal, and all store integrations.

**How to verify:**

1. Run `npx vite dev` (or `npm run dev`) to start the dev server.
2. Open the app URL in your browser.
3. Use browser DevTools to toggle mobile viewport (e.g., iPhone 14 Pro, 393x852).

**People tab:**
4. Verify dark theme (dark gray/black background, light text).
5. Tap the name input — keyboard should appear. Type "Alice" and tap "Add". Verify Alice appears in the list.
6. Add "Bob" and "Charlie".
7. Tap "Add" with empty input — verify "Name required" error appears in red.
8. Type "alice" (lowercase) and tap "Add" — verify "Name already exists" error.
9. Tap the "x" button next to "Charlie" — verify Charlie is removed.

**Items tab:**
10. Switch to "Items" tab via bottom navigation.
11. Tap the "+" button — verify a new empty row appears.
12. Type "Pasta" in the name field. Type "18.50" in the price field. Tap elsewhere (blur).
13. Verify the subtotal bar at the top now shows "$18.50".
14. Add another item "Wine" at "$12.00" with quantity 2 (tap the "+" stepper once).
15. Verify subtotal shows "$42.50" (18.50 + 12.00 x 2).
16. Verify minus stepper is disabled at quantity 1 for "Pasta".

**Assignments tab:**
17. Switch to "Assign" tab. Verify items listed with "0/2" counts.
18. Note the amber warning badge on the Assign tab in the bottom bar.
19. Tap "Pasta" to expand — verify "Everyone" button and "Alice"/"Bob" checkboxes.
20. Tap "Everyone" — verify both checkboxes checked, count shows "2/2".
21. Tap "Wine" to expand. Check only "Alice". Verify count shows "1/2".
22. Verify amber "!" warning appears only for items with zero assignments (not partially assigned items).

**Tab switching:**
23. Switch back to People tab — verify Alice and Bob still listed (not lost).
24. Switch to Items tab — verify items and prices preserved.

**Overall feel:**
25. Verify all buttons and inputs are large enough to tap without zooming (min 44px).
26. Verify the dark color scheme looks appropriate for dim restaurant lighting.
27. Verify bottom tabs are reachable with one thumb.
  </action>
  <verify>User confirms the complete data entry flow works correctly on mobile viewport with dark theme.</verify>
  <done>User types "approved" confirming the data entry flow is correct, or describes issues to fix.</done>
</task>

</tasks>

<verification>
1. `npx vitest run` — all tests pass (Phase 1 + currency + PeoplePanel + ItemsPanel + AssignmentPanel)
2. `npx vite build` — builds with no TypeScript errors
3. Human verified: complete data entry flow works on mobile viewport with dark theme
4. Tab switching preserves all entered data
5. Unassigned items show amber badge, assigned items do not
6. Running subtotal reflects all item changes in real time
</verification>

<success_criteria>
- Assignment panel: item-centric layout, expandable checkboxes, "Everyone" button toggles all, amber "!" on unassigned items — verified by 10+ component tests
- Full data entry flow: People -> Items -> Assignments works end-to-end on mobile viewport
- Dark theme consistent across all panels (bg-gray-950/900/800 hierarchy)
- All touch targets >= 44px (min-h-10/min-h-12 Tailwind classes)
- Tab switching preserves data (all panels stay mounted via CSS hidden)
- Human approved visual checkpoint
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-entry/02-03-SUMMARY.md`
</output>
