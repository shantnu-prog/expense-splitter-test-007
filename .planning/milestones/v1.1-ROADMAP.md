# Roadmap: Expense Splitter v1.1

## Overview

v1.1 adds persistence and sharing to the v1.0 MVP. Phase 6 builds the localStorage layer (safe adapter, branded-type deserialization, persist middleware on both stores, schema versioning). Phase 7 adds the history UI (list, load/edit, save/update, delete-with-undo) and coordinates app entry. Phase 8 extends the Person model with UPI contact details and adds payer-directed payment requests via upi:// deep links.

## Phases

- [x] **Phase 6: Persistence Foundation** - Safe localStorage adapter, deserializeBillConfig parse boundary, billStore + historyStore persist middleware, schema versioning (completed 2026-02-21)
- [x] **Phase 7: History List + Edit Mode** - HistoryPanel, HistoryRow, tab integration, save/update flow, editing indicator, delete-with-undo (completed 2026-02-24)
- [x] **Phase 8: UPI Payments** - Person contact fields (mobile + UPI VPA), buildUpiLink utility, PaymentSection payer selector, UPI deep link buttons (completed 2026-02-24)

## Phase Details

### Phase 6: Persistence Foundation
**Goal**: The app reliably stores and restores bill data through localStorage — current sessions survive page refresh, completed bills can be saved to history, and stored data survives schema changes without data loss
**Depends on**: Phase 5 (v1.0 complete)
**Requirements**: PERS-01, PERS-02, PERS-03
**Success Criteria**:
  1. User refreshes the page mid-entry and all people, items, assignments, tip, and tax are exactly as left
  2. User taps "Save Split" and the completed bill is added to persistent history that survives closing and reopening the browser
  3. App continues to load and display existing saved splits after a schema migration — no data is silently lost or corrupted
  4. App opens without crashing in Safari Private Browsing mode
**Plans**: 2/2 complete
- [x] 06-01-PLAN.md — Safe localStorage adapter and branded-type deserialization layer
- [x] 06-02-PLAN.md — History store and bill store persist middleware

### Phase 7: History List + Edit Mode
**Goal**: Users can see their saved splits on app open, tap any entry to re-open and edit it, start a fresh split from the history screen, and delete entries with a 5-second undo window
**Depends on**: Phase 6
**Requirements**: HIST-01, HIST-02, HIST-03, HIST-04
**Success Criteria**:
  1. User with saved splits opens the app and sees a history list showing date, people names, and total for each entry
  2. User taps a history entry and the full bill is restored into the editor with an "Editing saved split" indicator visible
  3. User on the history screen taps "New Split" and gets a clean, empty bill editor
  4. User deletes a saved split and sees an undo toast; tapping undo within 5 seconds restores the entry
  5. User with no saved history sees an appropriate empty state
**Plans**: 2/2 complete
- [x] 07-01-PLAN.md — History panel, tab integration, delete with undo
- [x] 07-02-PLAN.md — App entry coordination, load/edit flow, save/update button

### Phase 8: UPI Payments
**Goal**: Users can store contact details (mobile + UPI VPA) per person, select who paid the bill, and request payment from each person via UPI deep links
**Depends on**: Phase 7
**Requirements**: PAY-01, PAY-02, PAY-03, PAY-04, PAY-05
**Success Criteria**:
  1. User can enter mobile number and UPI VPA when adding a person; these fields persist across page refresh and in saved history
  2. User selects who paid the bill; the payer is excluded from payment requests
  3. Each non-payer person with a UPI VPA has a "Request via UPI" button with correct deep link
  4. Persons without a UPI VPA show a fallback (amount text only, no broken link)
  5. Contact details survive schema migration — old saved splits load without crashing
**Plans**: 2/2 complete
- [x] 08-01-PLAN.md — Person contact details (mobile + UPI VPA), schema migration v1→v2
- [x] 08-02-PLAN.md — Payer selector, UPI deep link utility, PaymentSection component

## Key Decisions

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| Explicit save (not auto-save-to-history) | Avoids cluttering history with incomplete bills | Good |
| Two-store architecture (billStore + historyStore) | Separates ephemeral active bill from persistent history | Good |
| Inputs-only storage (BillConfig, no derived outputs) | Engine re-computes on demand; no stale cached data | Good |
| 50-entry history cap | Prevents localStorage quota errors with one guard in save() | Good |
| persist(immer(creator)) middleware order | persist MUST wrap immer; wrong order causes silent state loss | Good — documented as critical pattern |
| Single parse boundary (deserializeBillConfig) | All branded type rehydration in one place; easy to extend | Good |
| Payer state stays local (component useState) | Display preference only; must not enter bill store or history | Good |
| UPI deep links (not Venmo/Zelle) | Indian market focus; standard upi://pay protocol | Good |
| buildUpiLink returns null (not throws) | Callers check null for conditional UPI button vs fallback | Good |
| Schema version 2 with no-op migration | Optional fields default to undefined; deserializer handles both old and new | Good |

## Stats

- **Phases**: 3
- **Plans**: 6
- **Tasks**: 15
- **Tests**: 125 → 144 (+19)
- **Build size**: 244 KB (76 KB gzip)
- **Timeline**: 3 days (2026-02-22 to 2026-02-24)

---
*Archived: 2026-02-24*
