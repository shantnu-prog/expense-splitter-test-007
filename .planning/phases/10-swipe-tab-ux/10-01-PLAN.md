---
phase: 10-swipe-tab-ux
plan: 01
title: "Swipe navigation and unassigned count badge"
requirements: [UX-01, UX-02, UX-03, UX-04]
depends_on: []
estimated_tasks: 3

must_haves:
  - "react-swipeable is installed as a production dependency"
  - "TABS array is exported from TabBar.tsx (not just const, but export const)"
  - "AppShell uses useSwipeable hook with onSwipedLeft and onSwipedRight handlers"
  - "Swiping left advances to next tab in order; swiping right goes to previous tab"
  - "Swiping right on History (first tab) does nothing — no wrapping"
  - "Swiping left on Split (last tab) does nothing — no wrapping"
  - "Swipe handlers check event target tagName — INPUT, TEXTAREA, SELECT are excluded"
  - "Main content area has style={{ touchAction: 'pan-y' }} to prevent vertical scroll interference"
  - "delta is 50px and swipeDuration is 500ms for conservative swipe detection"
  - "Assign tab badge shows the unassigned count number (e.g., '3') instead of just a dot"
  - "Badge uses amber/orange background with white text, min-w for circular shape"
  - "All existing 144 tests still pass"

key_links:
  - from: "src/components/layout/AppShell.tsx"
    to: "react-swipeable"
    via: "import { useSwipeable } from 'react-swipeable'"
  - from: "src/components/layout/AppShell.tsx"
    to: "src/components/layout/TabBar.tsx"
    via: "import { TABS } from './TabBar' for tab index navigation"
---

# Plan 10-01: Swipe Navigation and Unassigned Count Badge

## Goal

Add horizontal swipe gestures to navigate between tabs on mobile, with proper input field exclusion and scroll conflict prevention. Also upgrade the Assign tab badge from a small dot to a visible count number.

## Context

- Current `AppShell.tsx` holds `activeTab` state and passes `setActiveTab` to `TabBar`
- All panels are CSS-hidden (mounted but toggled with `hidden` class) — swipe just changes `activeTab`
- `TabBar.tsx` has `TABS` array (not exported) defining tab order: history, people, items, assignments, split
- TabBar already receives `unassignedCount` prop and shows a small amber dot badge
- Research recommends react-swipeable v7.0.2 with `touch-action: pan-y` CSS approach
- 5 tabs total, no wrapping at edges

## Tasks

### Task 1: Install react-swipeable and export TABS

**Do:**
1. Run `npm install react-swipeable`
2. Edit `src/components/layout/TabBar.tsx`:
   - Change `const TABS` to `export const TABS` (line 20)
   - No other changes to TabBar in this task

**Verify:**
- `npm ls react-swipeable` shows it installed
- `npx tsc --noEmit` passes (export doesn't break anything since TabBar still uses it internally)

### Task 2: Add swipe handlers to AppShell

**Do:**
1. Edit `src/components/layout/AppShell.tsx`:
   - Add import: `import { useSwipeable } from 'react-swipeable';`
   - Update TabBar import to also import TABS: `import { TabBar, TABS, type Tab } from './TabBar';`
   - Add swipe handler inside `AppShell` component (after the state declarations, before the return):

```typescript
const swipeHandlers = useSwipeable({
  onSwipedLeft: (eventData) => {
    const tag = (eventData.event.target as HTMLElement).tagName;
    if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;
    const idx = TABS.findIndex((t) => t.id === activeTab);
    if (idx < TABS.length - 1) setActiveTab(TABS[idx + 1].id);
  },
  onSwipedRight: (eventData) => {
    const tag = (eventData.event.target as HTMLElement).tagName;
    if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;
    const idx = TABS.findIndex((t) => t.id === activeTab);
    if (idx > 0) setActiveTab(TABS[idx - 1].id);
  },
  delta: 50,
  swipeDuration: 500,
  preventScrollOnSwipe: false,
  trackTouch: true,
  trackMouse: false,
});
```

2. Attach handlers and touch-action to the `<main>` element:

```tsx
<main
  {...swipeHandlers}
  className="flex-1 overflow-y-auto pb-16 overscroll-contain"
  style={{ touchAction: 'pan-y' }}
>
```

Key design decisions:
- `touch-action: pan-y` is set via style prop (not Tailwind) because Tailwind's `touch-pan-y` may not be available without explicit config
- `preventScrollOnSwipe: false` — let CSS `touch-action` handle scroll conflicts at the compositor level (more reliable than JS)
- `trackMouse: false` — mobile-only; swipe is a touch gesture
- Input exclusion via tagName check prevents swipe during text selection or number input adjustment
- No wrapping: bounds check with `idx > 0` and `idx < TABS.length - 1`

**Verify:**
- `npx tsc --noEmit` passes
- `npx vitest run` — all 144 tests pass

### Task 3: Upgrade Assign tab badge to count number

**Do:**
1. Edit `src/components/layout/TabBar.tsx`:
   - Replace the current dot badge:
   ```tsx
   <span
     aria-label={`${unassignedCount} unassigned`}
     className="absolute top-2 right-1/3 w-2 h-2 bg-amber-400 rounded-full"
   />
   ```
   - With a count badge:
   ```tsx
   <span
     aria-label={`${unassignedCount} unassigned`}
     className="absolute -top-0.5 left-1/2 ml-1 min-w-5 h-5 flex items-center justify-center rounded-full bg-amber-500 text-[10px] font-bold text-white"
   >
     {unassignedCount}
   </span>
   ```

Key design decisions:
- `min-w-5 h-5` (20px) gives enough room for 1-2 digit numbers
- `text-[10px]` is small enough to not overwhelm the tab label
- `bg-amber-500` is slightly brighter than the old amber-400 dot for better visibility with text
- `left-1/2 ml-1` positions it to the right of the label center
- `-top-0.5` sits just above the tab button top edge
- White text on amber background for contrast

**Verify:**
- `npx tsc --noEmit` passes
- `npx vitest run` — all 144 tests pass
- `npm run build` succeeds

## Acceptance

After this plan:
- User can swipe left/right to navigate between all 5 tabs
- Swiping on input/textarea/select fields does NOT trigger tab changes
- Vertical scrolling inside panels does NOT accidentally change tabs (touch-action: pan-y)
- Swiping at edges (History left-most, Split right-most) does nothing — no wrapping
- Assign tab shows unassigned count (e.g., "3") as a visible amber badge with white text
- All 144 tests pass, TypeScript clean, build succeeds
