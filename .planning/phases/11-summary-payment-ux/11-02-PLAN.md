---
phase: 11-summary-payment-ux
plan: 02
title: "Custom tip live dollar preview"
requirements: [SUM-03]
depends_on: []
estimated_tasks: 2

must_haves:
  - "When custom tip is selected and user types a percentage, a live dollar amount preview appears"
  - "Preview format is 'X% = $Y.YY' and updates on every keystroke (not just blur)"
  - "Preview is positioned below the custom percentage input"
  - "Preview disappears when custom tip input is empty or zero"
  - "Preview uses muted text styling consistent with dark theme"
  - "TipSegmentedControl receives subtotalCents prop for the calculation"
  - "All existing 144 tests still pass"

key_links:
  - from: "src/components/tip-tax/TipTaxPanel.tsx"
    to: "src/components/tip-tax/TipSegmentedControl.tsx"
    via: "subtotalCents prop passed from TipTaxPanel to TipSegmentedControl"
---

# Plan 11-02: Custom Tip Live Dollar Preview

## Goal

Show a live dollar amount preview when the user types a custom tip percentage, so they can see the actual tip amount (e.g., "5% = $3.25") updating in real-time as they type.

## Context

- `TipTaxPanel` holds `subtotal` (from `useSubtotal()` hook) and passes `customTipPct` to `TipSegmentedControl`
- `TipSegmentedControl` currently shows a percentage input when "Custom" is selected but no dollar preview
- The custom tip input (line 89-100) uses `inputMode="decimal"` and filters to digits + single decimal
- `centsToDollars()` utility already exists for formatting
- Subtotal is in cents (integer)

## Tasks

### Task 1: Pass subtotalCents to TipSegmentedControl

**Do:**
1. Edit `src/components/tip-tax/TipSegmentedControl.tsx`:
   - Add `subtotalCents` to interface:
     ```typescript
     interface TipSegmentedControlProps {
       selected: TipPreset;
       customValue: string;
       onPresetChange: (preset: TipPreset) => void;
       onCustomChange: (value: string) => void;
       onCustomBlur?: () => void;
       subtotalCents?: number;
     }
     ```
   - Destructure the new prop:
     ```typescript
     export function TipSegmentedControl({
       selected,
       customValue,
       onPresetChange,
       onCustomChange,
       onCustomBlur,
       subtotalCents,
     }: TipSegmentedControlProps) {
     ```

2. Edit `src/components/tip-tax/TipTaxPanel.tsx`:
   - Pass subtotal to the component:
     ```tsx
     <TipSegmentedControl
       selected={tipPreset}
       customValue={customTipPct}
       onPresetChange={handlePresetChange}
       onCustomChange={handleCustomTipChange}
       onCustomBlur={handleCustomTipBlur}
       subtotalCents={subtotal}
     />
     ```

**Verify:**
- `npx tsc --noEmit` passes

### Task 2: Add live dollar preview below custom input

**Do:**
1. Edit `src/components/tip-tax/TipSegmentedControl.tsx`:
   - Add import: `import { centsToDollars } from '../../utils/currency';`
   - Add import: `import { cents } from '../../engine/types';`
   - Inside the `{selected === 'custom' && (...)}` block, after the input row, add the preview:
     ```tsx
     {selected === 'custom' && (
       <div className="space-y-2">
         <div className="flex items-center gap-2">
           <input ... existing input ... />
           <span className="text-sm text-gray-400">%</span>
         </div>
         {(() => {
           const pct = parseFloat(customValue);
           if (!isNaN(pct) && pct > 0 && subtotalCents && subtotalCents > 0) {
             const tipCentsVal = Math.round((pct / 100) * subtotalCents);
             return (
               <p className="text-xs text-gray-500">
                 {customValue}% = ${centsToDollars(cents(tipCentsVal))}
               </p>
             );
           }
           return null;
         })()}
       </div>
     )}
     ```

   Note: The existing structure wraps the input in a `<div className="flex items-center gap-2">`. The preview goes below that div but inside the custom block. The current code structure is:
   ```tsx
   {selected === 'custom' && (
     <div className="flex items-center gap-2">
       <input ... />
       <span>%</span>
     </div>
   )}
   ```
   Change to:
   ```tsx
   {selected === 'custom' && (
     <div className="space-y-2">
       <div className="flex items-center gap-2">
         <input ... />
         <span>%</span>
       </div>
       {/* Live dollar preview */}
       {(() => {
         const pct = parseFloat(customValue);
         if (!isNaN(pct) && pct > 0 && subtotalCents && subtotalCents > 0) {
           const tipCentsVal = Math.round((pct / 100) * subtotalCents);
           return (
             <p className="text-xs text-gray-500 pl-1">
               {customValue}% = ${centsToDollars(cents(tipCentsVal))}
             </p>
           );
         }
         return null;
       })()}
     </div>
   )}
   ```

**Verify:**
- `npx tsc --noEmit` passes
- `npx vitest run` — all 144 tests pass
- `npm run build` succeeds

## Acceptance

After this plan:
- User selects "Custom" tip, types "5" → sees "5% = $3.25" below the input (if subtotal is $65.00)
- Preview updates on every keystroke (not just blur)
- Preview disappears when input is empty or "0"
- Preview styling is muted (text-gray-500, text-xs) — doesn't compete with the input
- All 144 tests pass, TypeScript clean, build succeeds
