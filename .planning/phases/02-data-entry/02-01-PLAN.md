---
phase: 02-data-entry
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - vite.config.ts
  - src/test/setup.ts
  - src/utils/currency.ts
  - src/utils/currency.test.ts
  - src/hooks/useSubtotal.ts
  - src/components/layout/TabBar.tsx
  - src/components/layout/SubtotalBar.tsx
  - src/components/layout/AppShell.tsx
  - src/App.tsx
  - src/index.css
autonomous: true
requirements:
  - UX-01
  - ITEM-05

must_haves:
  truths:
    - "App renders a dark-themed shell with bg-gray-950 background"
    - "Three tabs (People, Items, Assign) are visible at the bottom of the screen"
    - "Tapping a tab switches the visible panel content"
    - "Running subtotal displays $0.00 when no items exist"
    - "dollarsToCents('12.50') returns cents(1250) and centsToDollars(cents(1250)) returns '12.50'"
    - "All existing Phase 1 tests still pass"
  artifacts:
    - path: "src/test/setup.ts"
      provides: "jest-dom matcher registration for component tests"
      contains: "@testing-library/jest-dom/vitest"
    - path: "src/utils/currency.ts"
      provides: "Dollar-to-cents and cents-to-dollars conversion helpers"
      exports: ["dollarsToCents", "centsToDollars", "filterPriceInput"]
    - path: "src/utils/currency.test.ts"
      provides: "Unit tests for currency conversion"
      min_lines: 20
    - path: "src/hooks/useSubtotal.ts"
      provides: "Hook computing running subtotal from store items"
      exports: ["useSubtotal"]
    - path: "src/components/layout/AppShell.tsx"
      provides: "Root layout with subtotal bar, panel area, and tab bar"
      exports: ["AppShell"]
    - path: "src/components/layout/TabBar.tsx"
      provides: "Bottom tab navigation with 3 tabs and unassigned badge"
      exports: ["TabBar"]
    - path: "src/components/layout/SubtotalBar.tsx"
      provides: "Sticky subtotal display using useSubtotal hook"
      exports: ["SubtotalBar"]
  key_links:
    - from: "src/components/layout/SubtotalBar.tsx"
      to: "src/hooks/useSubtotal.ts"
      via: "useSubtotal() hook call"
      pattern: "useSubtotal"
    - from: "src/hooks/useSubtotal.ts"
      to: "src/store/billStore.ts"
      via: "useBillStore selector on config.items"
      pattern: "useBillStore"
    - from: "src/components/layout/SubtotalBar.tsx"
      to: "src/utils/currency.ts"
      via: "centsToDollars for display formatting"
      pattern: "centsToDollars"
    - from: "src/App.tsx"
      to: "src/components/layout/AppShell.tsx"
      via: "renders AppShell as root component"
      pattern: "AppShell"
---

<objective>
Install test dependencies, create currency conversion utilities, and build the app shell layout with dark theme, bottom tab navigation, and sticky running subtotal.

Purpose: Establishes the shared UI foundation that all three panel plans build on. Without the shell, tabs, and subtotal bar, individual panels have nowhere to render. Without test infrastructure, component tests cannot run. Without currency utils, price inputs cannot convert dollars to cents safely.

Output: Working dark-themed app shell with tab switching, $0.00 subtotal, passing currency unit tests, and test infrastructure ready for component tests.
</objective>

<execution_context>
@/Users/shantnupatil/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shantnupatil/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-data-entry/02-CONTEXT.md
@.planning/phases/02-data-entry/02-RESEARCH.md
@src/engine/types.ts
@src/store/billStore.ts
@src/App.tsx
@src/main.tsx
@src/index.css
@vite.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install test dependencies and create currency utilities with tests</name>
  <files>
    vite.config.ts
    src/test/setup.ts
    src/utils/currency.ts
    src/utils/currency.test.ts
  </files>
  <action>
1. Install dev dependencies for component testing:
   ```
   npm install -D @testing-library/react @testing-library/user-event @testing-library/jest-dom jsdom
   ```

2. Update `vite.config.ts` — add setupFiles for jest-dom matchers. Keep `environment: 'node'` as default (engine/store tests stay fast). Component tests use per-file `// @vitest-environment jsdom` directive.
   ```ts
   test: {
     globals: true,
     environment: 'node',
     passWithNoTests: true,
     setupFiles: ['./src/test/setup.ts'],
   }
   ```

3. Create `src/test/setup.ts`:
   ```ts
   import '@testing-library/jest-dom/vitest';
   ```

4. Create `src/utils/currency.ts` with three exports:
   - `dollarsToCents(input: string): Cents | null` — strip non-numeric chars except `.`, parse float, multiply by 100, round via `cents()` constructor from `../engine/types`. Return `null` for empty, non-finite, or negative input.
   - `centsToDollars(value: Cents): string` — divide by 100, `.toFixed(2)`.
   - `filterPriceInput(value: string): string` — remove non-digit/non-dot chars, allow only one decimal point, limit to 2 decimal places.

   Import `cents` and `Cents` from `../engine/types`.

5. Create `src/utils/currency.test.ts` — unit tests (runs in node environment, no jsdom needed):
   - `dollarsToCents("12.50")` returns `1250` (as Cents)
   - `dollarsToCents("0.01")` returns `1`
   - `dollarsToCents("12.10")` returns `1210` (IEEE 754 edge case — `12.10 * 100 = 1210.0000000000002` must round correctly)
   - `dollarsToCents("")` returns `null`
   - `dollarsToCents("abc")` returns `null`
   - `dollarsToCents("-5.00")` returns `null`
   - `centsToDollars(cents(1250))` returns `"12.50"`
   - `centsToDollars(cents(0))` returns `"0.00"`
   - `centsToDollars(cents(7))` returns `"0.07"`
   - `filterPriceInput("12.50abc")` returns `"12.50"`
   - `filterPriceInput("12..50")` returns `"12.50"` (removes extra dot)
   - `filterPriceInput("12.505")` returns `"12.50"` (truncates to 2 decimal places)

6. Run `npx vitest run` — all existing 66 Phase 1 tests AND new currency tests must pass.
  </action>
  <verify>
    `npx vitest run` passes with 0 failures. Currency test file shows all cases passing. Existing engine and store tests unaffected.
  </verify>
  <done>
    Test infrastructure installed and configured. `dollarsToCents` and `centsToDollars` correctly convert at the IEEE 754 boundary. `filterPriceInput` sanitizes input. All 66+ tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build app shell with dark theme, bottom tabs, and sticky subtotal</name>
  <files>
    src/index.css
    src/hooks/useSubtotal.ts
    src/components/layout/TabBar.tsx
    src/components/layout/SubtotalBar.tsx
    src/components/layout/AppShell.tsx
    src/App.tsx
  </files>
  <action>
1. Update `src/index.css` — add dark base styles after the Tailwind import:
   ```css
   @import "tailwindcss";

   html, body, #root {
     @apply min-h-screen bg-gray-950 text-gray-100;
   }
   ```
   This makes the entire app dark by default. No `dark:` prefix needed anywhere — use dark colors directly per locked decision.

2. Create `src/hooks/useSubtotal.ts`:
   - Import `useBillStore` from `../store/billStore` and `cents`, `Cents` from `../engine/types`.
   - Export `useSubtotal(): Cents` — selects `s.config.items` from store, reduces to sum of `item.priceCents * item.quantity` for each item, returns as `Cents`.
   - Use a single-value selector (no `useShallow` needed — just `useBillStore((s) => s.config.items)` returns the same array reference until items change).

3. Create `src/components/layout/TabBar.tsx`:
   - Define `type Tab = 'people' | 'items' | 'assignments'` and export it.
   - Props: `activeTab: Tab`, `onTabChange: (tab: Tab) => void`, `unassignedCount: number`.
   - Render a `<nav>` fixed to bottom (`fixed bottom-0 inset-x-0`), `bg-gray-900 border-t border-gray-700`.
   - Three buttons, each `flex-1 min-h-12 py-3 text-sm font-medium`. Labels: "People", "Items", "Assign".
   - Active tab: `text-blue-400 border-t-2 border-blue-400`. Inactive: `text-gray-400`.
   - On the "Assign" tab button, if `unassignedCount > 0`, show a small amber dot (`w-2 h-2 bg-amber-400 rounded-full`) positioned absolutely — this is the subtle warning badge per locked decision.
   - Add `role="tablist"` on nav, `role="tab"` and `aria-selected` on each button for basic a11y.

4. Create `src/components/layout/SubtotalBar.tsx`:
   - Import `useSubtotal` and `centsToDollars`.
   - Render a sticky div at top (`sticky top-0 z-10 bg-gray-900 border-b border-gray-700 px-4 py-2`).
   - Left side: "Subtotal" label in `text-gray-400 text-sm`.
   - Right side: dollar amount in `text-white font-semibold text-lg tabular-nums`, formatted as `$${centsToDollars(subtotal)}`.

5. Create `src/components/layout/AppShell.tsx`:
   - Import SubtotalBar, TabBar, and the Tab type.
   - Use `useState<Tab>('people')` for active tab (local UI state — NOT in Zustand per anti-pattern guidance).
   - Compute `unassignedCount` for the TabBar badge: select `config.items` and `config.assignments` from store using `useShallow`, count items where `assignments[item.id]` is empty or missing.
   - Layout structure (top to bottom): SubtotalBar, main content area (`flex-1 overflow-y-auto pb-16` — padding-bottom for the fixed tab bar), TabBar.
   - For content area: render placeholder `<div>` elements for each panel. Keep ALL three mounted using CSS `hidden` class to preserve scroll position and input state per research recommendation. Pattern: `<div className={activeTab === 'people' ? '' : 'hidden'}>People panel placeholder</div>` for each tab.
   - These placeholders will be replaced by real panel components in Plans 02 and 03.

6. Update `src/App.tsx`:
   - Replace the existing `<div>Expense Splitter</div>` with `<AppShell />`.
   - Import AppShell from `./components/layout/AppShell`.

7. Run `npx vite build` to verify no TypeScript or build errors. Run `npx vitest run` to confirm all tests still pass.
  </action>
  <verify>
    `npx vite build` succeeds with no errors. `npx vitest run` passes all tests. `npx vite --open` shows dark-themed app with subtotal bar showing "$0.00" and three bottom tabs that switch content.
  </verify>
  <done>
    Dark-themed app shell renders with: (1) sticky subtotal bar at top showing $0.00, (2) three bottom tabs (People, Items, Assign) that switch visible content, (3) all panels kept mounted with CSS hidden, (4) amber badge dot ready for unassigned items count. Mobile-friendly with min-h-12 touch targets on tabs.
  </done>
</task>

</tasks>

<verification>
1. `npx vitest run` — all existing Phase 1 tests (66) plus new currency tests pass
2. `npx vite build` — builds with no TypeScript errors
3. Dev server shows dark background (bg-gray-950), subtotal bar, and bottom tabs
4. Tapping tabs switches visible panel content
5. Subtotal shows "$0.00" with no items in store
</verification>

<success_criteria>
- Test infrastructure: @testing-library/react, user-event, jest-dom, jsdom installed; setup.ts loads jest-dom matchers
- Currency utils: dollarsToCents handles IEEE 754 edge cases (12.10 * 100), centsToDollars formats correctly, filterPriceInput sanitizes input — all verified by unit tests
- App shell: dark bg-gray-950 theme, sticky SubtotalBar at top, three-tab TabBar fixed at bottom, panels toggled by CSS hidden class
- All 66+ tests pass, build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-entry/02-01-SUMMARY.md`
</output>
