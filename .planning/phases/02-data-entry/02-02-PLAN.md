---
phase: 02-data-entry
plan: 02
type: execute
wave: 2
depends_on:
  - 02-01
files_modified:
  - src/components/people/PeoplePanel.tsx
  - src/components/people/PersonRow.tsx
  - src/components/people/PeoplePanel.test.tsx
  - src/components/items/ItemsPanel.tsx
  - src/components/items/ItemRow.tsx
  - src/components/items/ItemsPanel.test.tsx
  - src/components/layout/AppShell.tsx
autonomous: true
requirements:
  - PEOP-01
  - PEOP-02
  - ITEM-01
  - ITEM-02
  - ITEM-03
  - ITEM-04
  - ITEM-05

must_haves:
  truths:
    - "User can type a name and tap Add to see the person listed"
    - "Tapping Add with an empty name shows 'Name required' error"
    - "Tapping Add with a duplicate name shows 'Name already exists' error"
    - "User can remove a person from the list"
    - "User can tap '+' to add a new item row and type name and price inline"
    - "User can edit an existing item's name or price by tapping the field"
    - "User can adjust quantity with plus/minus stepper buttons"
    - "User can remove an item from the list"
    - "Running subtotal in the header updates immediately when items change"
    - "Price input shows numeric decimal keyboard on mobile (inputmode='decimal')"
  artifacts:
    - path: "src/components/people/PeoplePanel.tsx"
      provides: "People list with add form and validation"
      min_lines: 40
    - path: "src/components/people/PersonRow.tsx"
      provides: "Single person row with remove button"
      min_lines: 15
    - path: "src/components/people/PeoplePanel.test.tsx"
      provides: "Component tests for add/remove/validation"
      min_lines: 40
    - path: "src/components/items/ItemsPanel.tsx"
      provides: "Item list with add button and running subtotal integration"
      min_lines: 40
    - path: "src/components/items/ItemRow.tsx"
      provides: "Single item row with inline edit, price input, quantity stepper, remove"
      min_lines: 50
    - path: "src/components/items/ItemsPanel.test.tsx"
      provides: "Component tests for add/edit/remove/quantity/subtotal"
      min_lines: 40
  key_links:
    - from: "src/components/people/PeoplePanel.tsx"
      to: "src/store/billStore.ts"
      via: "useBillStore with useShallow for people, addPerson, removePerson"
      pattern: "useBillStore.*useShallow"
    - from: "src/components/items/ItemsPanel.tsx"
      to: "src/store/billStore.ts"
      via: "useBillStore with useShallow for items, addItem, removeItem, updateItem"
      pattern: "useBillStore.*useShallow"
    - from: "src/components/items/ItemRow.tsx"
      to: "src/utils/currency.ts"
      via: "dollarsToCents on blur, centsToDollars for display, filterPriceInput on change"
      pattern: "dollarsToCents|centsToDollars|filterPriceInput"
    - from: "src/components/layout/AppShell.tsx"
      to: "src/components/people/PeoplePanel.tsx"
      via: "renders PeoplePanel in people tab slot"
      pattern: "PeoplePanel"
    - from: "src/components/layout/AppShell.tsx"
      to: "src/components/items/ItemsPanel.tsx"
      via: "renders ItemsPanel in items tab slot"
      pattern: "ItemsPanel"
---

<objective>
Build the People panel (add/remove people with name validation) and Items panel (add/edit/remove items with inline price input, quantity stepper, and running subtotal) as the two core data entry interfaces.

Purpose: These are the two input panels that populate the Zustand store with real data. Without people and items, the assignment panel and summary have nothing to work with. Both panels drive existing store actions (addPerson, removePerson, addItem, removeItem, updateItem) and must convert dollar input to integer cents at the UI boundary.

Output: Functional People and Items tabs with component tests, wired into the app shell from Plan 01.
</objective>

<execution_context>
@/Users/shantnupatil/.claude/get-shit-done/workflows/execute-plan.md
@/Users/shantnupatil/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-data-entry/02-CONTEXT.md
@.planning/phases/02-data-entry/02-RESEARCH.md
@.planning/phases/02-data-entry/02-01-SUMMARY.md
@src/engine/types.ts
@src/store/billStore.ts
@src/utils/currency.ts
@src/hooks/useSubtotal.ts
@src/components/layout/AppShell.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build People panel with add/remove and name validation</name>
  <files>
    src/components/people/PeoplePanel.tsx
    src/components/people/PersonRow.tsx
    src/components/people/PeoplePanel.test.tsx
    src/components/layout/AppShell.tsx
  </files>
  <action>
1. Create `src/components/people/PersonRow.tsx`:
   - Props: `name: string`, `onRemove: () => void`.
   - Render a row with person name on the left (`text-gray-100`) and a remove button on the right.
   - Remove button: `min-h-10 min-w-10` touch target, displays "x" or a remove icon, `text-gray-400 active:text-red-400`, `aria-label="Remove {name}"`.
   - Row styling: `flex items-center justify-between px-4 py-3 border-b border-gray-800`.

2. Create `src/components/people/PeoplePanel.tsx`:
   - Local state: `name` (string), `error` (string) via `useState`.
   - Store connection: use `useShallow` from `zustand/react/shallow` to select `config.people`, `addPerson`, `removePerson` from `useBillStore`.
   - Add form at top (`p-4 border-b border-gray-800`):
     - Text input: `flex-1 min-h-12 px-4 bg-gray-800 text-gray-100 rounded-lg border border-gray-700 focus:border-blue-500 focus:outline-none`, placeholder "Person name".
     - Add button: `min-h-12 px-6 bg-blue-600 text-white font-medium rounded-lg active:bg-blue-700`.
     - Enter key submits (onKeyDown: `e.key === 'Enter' && handleAdd()`).
   - Validation in `handleAdd`:
     - Trim name. If empty, set error "Name required" and return.
     - If `people.some(p => p.name.toLowerCase() === trimmed.toLowerCase())`, set error "Name already exists" and return.
     - Otherwise call `addPerson(trimmed)`, clear name and error.
   - Error display: `{error && <p className="text-red-400 text-sm mt-1">{error}</p>}` below the input row.
   - Clear error on input change: `onChange={(e) => { setName(e.target.value); setError(''); }}`.
   - People list below form: `flex-1 overflow-y-auto`. Map `people` to `<PersonRow>` with `key={person.id}`, passing `name={person.name}` and `onRemove={() => removePerson(person.id)}`.

3. Create `src/components/people/PeoplePanel.test.tsx`:
   - Add `// @vitest-environment jsdom` at the top.
   - Import `render`, `screen` from `@testing-library/react`, `userEvent` from `@testing-library/user-event`, and `useBillStore` from store.
   - `beforeEach`: reset store via `useBillStore.getState().reset()`.
   - Tests:
     a. "adds a person when name is entered and Add is clicked" — type "Alice", click Add, expect "Alice" in document.
     b. "adds a person on Enter key" — type "Bob", press Enter, expect "Bob" in document.
     c. "shows error for empty name" — click Add without typing, expect "Name required" in document.
     d. "shows error for duplicate name (case-insensitive)" — add "Alice" via store, type "alice", click Add, expect "Name already exists".
     e. "clears error when user starts typing" — click Add (shows error), type "A", expect "Name required" NOT in document.
     f. "removes a person when remove button is clicked" — add "Alice" via store, render, click button with aria-label "Remove Alice", expect "Alice" NOT in document.
     g. "clears input after successful add" — type "Alice", click Add, expect input value to be empty.

4. Update `src/components/layout/AppShell.tsx`:
   - Import `PeoplePanel` from `../people/PeoplePanel`.
   - Replace the people tab placeholder div content with `<PeoplePanel />`.
   - Keep the items and assignments placeholders as-is (will be replaced in this plan's Task 2 and Plan 03).

5. Run `npx vitest run` — all tests must pass including new PeoplePanel tests.
  </action>
  <verify>
    `npx vitest run` passes with 0 failures. PeoplePanel test file shows all 7 test cases passing. Dev server shows functional People tab.
  </verify>
  <done>
    People panel renders in the People tab. User can add people by name (via button or Enter key), see them listed, and remove them. Empty name shows "Name required", duplicate name shows "Name already exists". All interactions verified by component tests.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build Items panel with inline editing, price input, quantity stepper</name>
  <files>
    src/components/items/ItemRow.tsx
    src/components/items/ItemsPanel.tsx
    src/components/items/ItemsPanel.test.tsx
    src/components/layout/AppShell.tsx
  </files>
  <action>
1. Create `src/components/items/ItemRow.tsx`:
   - Props: `item: Item` (from engine/types), `onUpdate: (id: ItemId, updates: Partial<Pick<Item, 'label' | 'priceCents' | 'quantity'>>) => void`, `onRemove: (id: ItemId) => void`.
   - Import `dollarsToCents`, `centsToDollars`, `filterPriceInput` from `../../utils/currency`, `cents` and `Cents` from `../../engine/types`.
   - Layout: row with name input, price input, quantity stepper, remove button.
     - Name: `<input type="text" value={localLabel} ...>` — local state synced from `item.label`. Commit to store on blur via `onUpdate(item.id, { label: localLabel.trim() })`. If label is empty on blur, revert to previous value from `item.label`. Styling: `flex-1 bg-transparent text-gray-100 focus:bg-gray-800 rounded px-2 py-1 min-h-10`.
     - Price: `<input type="text" inputMode="decimal" value={localPrice} ...>` — local state initialized via `centsToDollars(item.priceCents)`. On change: `setLocalPrice(filterPriceInput(e.target.value))`. On blur: parse via `dollarsToCents(localPrice)` — if valid, call `onUpdate(item.id, { priceCents: parsed })` and normalize display via `setLocalPrice(centsToDollars(parsed))`; if null, revert to `centsToDollars(item.priceCents)`. Prefix with "$" sign (positioned absolutely or as inline span). Styling: `w-24 min-h-10 bg-gray-800 text-gray-100 rounded-lg border border-gray-700 pl-7 pr-2 text-right`, placeholder "0.00".
     - Quantity stepper: minus button (`min-w-10 min-h-10 rounded-lg bg-gray-800 text-gray-100 disabled:opacity-30 active:bg-gray-700`, disabled when `quantity <= 1`, aria-label "Decrease quantity"), quantity display (`min-w-8 text-center tabular-nums text-gray-100`), plus button (same styling, aria-label "Increase quantity"). Minus calls `onUpdate(item.id, { quantity: Math.max(1, item.quantity - 1) })`, plus calls `onUpdate(item.id, { quantity: item.quantity + 1 })`.
     - Remove button: `min-h-10 min-w-10 text-gray-400 active:text-red-400`, aria-label "Remove item", calls `onRemove(item.id)`.
   - Sync local state from props: when `item.id` changes, reset local label and price. Use `useEffect` with `item.id` dependency (NOT `item.priceCents` — that would fight the user's typing per pitfall #6 in research).

2. Create `src/components/items/ItemsPanel.tsx`:
   - Store connection: use `useShallow` to select `config.items`, `addItem`, `removeItem`, `updateItem` from `useBillStore`.
   - Add button at top: a "+" button (`min-h-12 w-full bg-gray-800 text-blue-400 font-medium rounded-lg border border-dashed border-gray-600 active:bg-gray-700`) that calls `addItem('', 0, 1)` — creates a new empty row per locked decision ("+ button creates new empty row, user types inline").
   - Item list below: map `items` to `<ItemRow>` with `key={item.id}`, passing `item`, `onUpdate={updateItem}`, `onRemove={removeItem}`.
   - Wrap in `flex flex-col h-full` with `p-4` for the add button area and `flex-1 overflow-y-auto` for the list.

3. Create `src/components/items/ItemsPanel.test.tsx`:
   - Add `// @vitest-environment jsdom` at the top.
   - `beforeEach`: reset store via `useBillStore.getState().reset()`.
   - Tests:
     a. "adds an empty item row when + button is clicked" — click the add button (find by text "+" or role), expect a new row to appear with empty name input and "0.00" price.
     b. "updates item name on blur" — add item via store, render, type in the name input, blur, verify store state updated.
     c. "converts dollar price to cents on blur" — add item via store, clear the price input, type "12.50", blur, verify `useBillStore.getState().config.items[0].priceCents` equals `1250`.
     d. "reverts invalid price on blur" — add item with priceCents 500, type "abc" in price field, blur, verify display reverts to "5.00".
     e. "increases quantity when + stepper is clicked" — add item via store, click increase button, verify quantity is 2.
     f. "decreases quantity but not below 1" — add item with quantity 1 via store, click decrease button, verify quantity stays 1 (button disabled).
     g. "removes item when remove button is clicked" — add item via store, click remove button, verify item gone from document.
     h. "subtotal updates when item is added" — this test renders the SubtotalBar alongside ItemsPanel (or checks the store). Add an item with priceCents 1250, verify the subtotal hook would compute correctly (can test via store: `items.reduce` equals 1250).

4. Update `src/components/layout/AppShell.tsx`:
   - Import `ItemsPanel` from `../items/ItemsPanel`.
   - Replace the items tab placeholder div content with `<ItemsPanel />`.

5. Run `npx vitest run` — all tests must pass.
  </action>
  <verify>
    `npx vitest run` passes with 0 failures. ItemsPanel test file shows all 8 test cases passing. Dev server shows functional Items tab with add/edit/remove/stepper. SubtotalBar in header updates when items are modified.
  </verify>
  <done>
    Items panel renders in the Items tab. User can tap "+" to add empty item row, type name and price inline, adjust quantity with stepper, and remove items. Price input uses inputmode="decimal", converts to cents on blur, reverts on invalid input. Running subtotal in the header reflects all item changes immediately. All interactions verified by component tests.
  </done>
</task>

</tasks>

<verification>
1. `npx vitest run` — all tests pass (Phase 1 + currency + PeoplePanel + ItemsPanel)
2. `npx vite build` — builds with no TypeScript errors
3. People tab: add "Alice" and "Bob", remove "Alice", verify duplicate name rejection
4. Items tab: add 3 items with different prices and quantities, verify subtotal in header matches manual calculation
5. Tab switching preserves entered data (people remain, items remain — panels are CSS hidden, not unmounted)
</verification>

<success_criteria>
- People panel: add by name (button + Enter), remove, "Name required" on empty, "Name already exists" on duplicate (case-insensitive), all verified by 7+ component tests
- Items panel: "+" creates empty row, inline name editing, dollar-to-cents price conversion on blur, quantity stepper (min 1), remove item, all verified by 8+ component tests
- Subtotal bar updates immediately when items are added/edited/removed
- Price inputs use `type="text" inputMode="decimal"` for mobile numeric keyboard
- All interactive elements have `min-h-12` or `min-h-10` touch targets
- All tests pass including Phase 1 suite
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-entry/02-02-SUMMARY.md`
</output>
